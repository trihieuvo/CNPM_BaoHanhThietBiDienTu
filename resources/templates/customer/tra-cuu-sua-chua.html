<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra c·ª©u t√¨nh tr·∫°ng s·ª≠a ch·ªØa</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }
        .search-box input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }
        .result-box {
            background: #f8fafc;
            padding: 32px;
            border-radius: 12px;
            margin-top: 24px;
        }
        .result-header {
            text-align: center;
            margin-bottom: 24px;
        }
        .result-header h2 {
            margin-bottom: 12px;
        }
        .info-grid {
            display: grid;
            gap: 16px;
            margin-bottom: 24px;
        }
        .guide-box {
            background: #eff6ff;
            padding: 24px;
            border-radius: 12px;
            margin-top: 32px;
        }
        .guide-box h3 {
            color: #1e40af;
            margin-bottom: 12px;
        }
        .guide-box ul {
            color: #1e40af;
            padding-left: 20px;
        }
        .guide-box li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div>
                    <h1>Tra c·ª©u t√¨nh tr·∫°ng s·ª≠a ch·ªØa</h1>
                    <p class="text-muted">Nh·∫≠p m√£ phi·∫øu ƒë·ªÉ tra c·ª©u</p>
                </div>
                <a href="/customer/dashboard" class="btn btn-outline">‚Üê Quay l·∫°i</a>
            </div>

            <!-- Form tra c·ª©u -->
            <form action="/customer/tra-cuu-sua-chua" method="get">
                <div class="search-box">
                    <input type="number" 
                           name="maPhieu" 
                           placeholder="Nh·∫≠p m√£ phi·∫øu s·ª≠a ch·ªØa..."
                           required>
                    <button type="submit" class="btn">üîç Tra c·ª©u</button>
                </div>
            </form>

            <!-- Th√¥ng b√°o l·ªói -->
            <div th:if="${errorMessage}" class="alert alert-danger">
                <span th:text="${errorMessage}"></span>
            </div>

            <!-- K·∫øt qu·∫£ tra c·ª©u -->
            <div th:if="${phieu}" class="result-box">
                <div class="result-header">
                    <h2>Phi·∫øu #<span th:text="${phieu.maPhieu}"></span></h2>
                    <span class="badge" 
                          th:classappend="${phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'} ? 'badge-success' : 
                                          (${phieu.trangThai == 'ƒêang s·ª≠a ch·ªØa'} ? 'badge-warning' : 
                                          (${phieu.trangThai == 'ƒê√£ s·ª≠a xong'} ? 'badge-info' : 'badge-danger'))"
                          th:text="${phieu.trangThai}">
                    </span>
                </div>

                <div class="info-grid">
                    <div class="info-row">
                        <strong>Thi·∫øt b·ªã:</strong>
                        <span th:text="${phieu.thietBi.hangSanXuat + ' ' + phieu.thietBi.model}"></span>
                    </div>
                    <div class="info-row">
                        <strong>Ng√†y ti·∫øp nh·∫≠n:</strong>
                        <span th:text="${#temporals.format(phieu.ngayTiepNhan, 'dd-MM-yyyy HH:mm')}"></span>
                    </div>
                    <div class="info-row" th:if="${phieu.ngayTraDuKien}">
                        <strong>Ng√†y tr·∫£ d·ª± ki·∫øn:</strong>
                        <span th:text="${#temporals.format(phieu.ngayTraDuKien, 'dd-MM-yyyy')}"></span>
                    </div>
                    <div class="info-row" th:if="${phieu.kyThuatVien}">
                        <strong>K·ªπ thu·∫≠t vi√™n:</strong>
                        <span th:text="${phieu.kyThuatVien.hoTen}"></span>
                    </div>
                    <div class="info-row" th:if="${phieu.tongChiPhi != null}">
                        <strong>Chi ph√≠ d·ª± t√≠nh:</strong>
                        <span style="color: #667eea; font-weight: bold;" 
                              th:text="${#numbers.formatDecimal(phieu.tongChiPhi, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></span>
                    </div>
                </div>

                <!-- Ghi ch√∫ k·ªπ thu·∫≠t -->
                <div th:if="${phieu.ghiChuKyThuat != null && !phieu.ghiChuKyThuat.isEmpty()}" 
                     class="note-box">
                    <strong style="color: #92400e;">üîß Ghi ch√∫ k·ªπ thu·∫≠t:</strong>
                    <p style="color: #78350f; margin: 8px 0 0; white-space: pre-wrap;" th:text="${phieu.ghiChuKyThuat}"></p>
                </div>

                <div style="text-align: center;">
                    <a th:href="@{/customer/phieu-sua-chua/{id}(id=${phieu.maPhieu})}" class="btn" style="text-decoration: none;">
                        Xem chi ti·∫øt ƒë·∫ßy ƒë·ªß ‚Üí
                    </a>
                </div>
            </div>

            <!-- H∆∞·ªõng d·∫´n -->
            <div th:unless="${phieu}" class="guide-box">
                <h3>üí° H∆∞·ªõng d·∫´n tra c·ª©u</h3>
                <ul>
                    <li>Nh·∫≠p m√£ phi·∫øu s·ª≠a ch·ªØa v√†o √¥ t√¨m ki·∫øm ·ªü tr√™n</li>
                    <li>M√£ phi·∫øu l√† s·ªë nguy√™n (v√≠ d·ª•: 1, 2, 3...)</li>
                    <li>B·∫°n c√≥ th·ªÉ t√¨m m√£ phi·∫øu trong email x√°c nh·∫≠n ho·∫∑c phi·∫øu ti·∫øp nh·∫≠n</li>
                    <li>Ho·∫∑c xem t·∫•t c·∫£ phi·∫øu c·ªßa b·∫°n t·∫°i <a href="/customer/lich-su-bao-hanh" class="link">L·ªãch s·ª≠ b·∫£o h√†nh</a></li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>