<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt phi·∫øu s·ª≠a ch·ªØa</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div th:replace="~{receptionist/fragments :: sidebar(activePage='dashboard')}"></div>

    <div class="main-content">
        <div class="card">
            <div class="header">
                <div>
                    <h1>Chi ti·∫øt phi·∫øu s·ª≠a ch·ªØa #<span th:text="${phieu.maPhieu}"></span></h1>
                    <p class="text-muted">Th√¥ng tin chi ti·∫øt v·ªÅ phi·∫øu s·ª≠a ch·ªØa</p>
                </div>
                <a href="/receptionist/dashboard" class="btn btn-outline">‚Üê Quay l·∫°i Danh s√°ch</a>
            </div>

            <div style="text-align: center; margin-bottom: 32px;">
                <span class="badge"
                      th:classappend="${phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'} ? 'badge-success' :
                                      (${phieu.trangThai == 'ƒêang s·ª≠a ch·ªØa'} ? 'badge-warning' :
                                      (${phieu.trangThai == 'ƒê√£ s·ª≠a xong'} ? 'badge-info' : 'badge-danger'))"
                      th:text="${phieu.trangThai}">
                </span>
            </div>

            <h3><i class="fas fa-info-circle"></i> Th√¥ng tin chung</h3>
            <div class="info-section">
                 <div class="info-row">
                    <div class="info-label">Kh√°ch h√†ng:</div>
                    <div class="info-value">
                        <strong th:text="${phieu.khachHang.hoTen}"></strong>
                        <div class="text-muted" style="font-size: 13px;">
                           SƒêT: <span th:text="${phieu.khachHang.soDienThoai}"></span>
                           <span th:if="${phieu.khachHang.email}"> | Email: <span th:text="${phieu.khachHang.email}"></span></span>
                        </div>
                    </div>
                </div>
                 <div class="info-row">
                    <div class="info-label">Thi·∫øt b·ªã:</div>
                    <div class="info-value">
                        <strong th:text="${phieu.thietBi.hangSanXuat + ' ' + phieu.thietBi.model}"></strong>
                        <div th:if="${phieu.thietBi.soSerial}" class="text-muted" style="font-size: 13px;">
                            Serial: <span th:text="${phieu.thietBi.soSerial}"></span>
                        </div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">T√¨nh tr·∫°ng ti·∫øp nh·∫≠n:</div>
                    <div class="info-value" th:text="${phieu.tinhTrangTiepNhan}"></div>
                </div>
                <div class="info-row">
                    <div class="info-label">Ng√†y ti·∫øp nh·∫≠n:</div>
                    <div class="info-value" th:text="${#temporals.format(phieu.ngayTiepNhan, 'dd-MM-yyyy HH:mm')}"></div>
                </div>
                <div class="info-row" th:if="${phieu.ngayTraDuKien}">
                    <div class="info-label">Ng√†y tr·∫£ d·ª± ki·∫øn:</div>
                    <div class="info-value" th:text="${#temporals.format(phieu.ngayTraDuKien, 'dd-MM-yyyy')}"></div>
                </div>
                 <div class="info-row" th:if="${phieu.ngayHoanThanh}">
                    <div class="info-label">Ng√†y ho√†n th√†nh:</div>
                    <div class="info-value" th:text="${#temporals.format(phieu.ngayHoanThanh, 'dd-MM-yyyy HH:mm')}"></div>
                </div>
                <div class="info-row" th:if="${phieu.nhanVienTiepNhan}">
                    <div class="info-label">Nh√¢n vi√™n ti·∫øp nh·∫≠n:</div>
                    <div class="info-value" th:text="${phieu.nhanVienTiepNhan.hoTen}"></div>
                </div>
                <div class="info-row" th:if="${phieu.kyThuatVien}">
                    <div class="info-label">K·ªπ thu·∫≠t vi√™n:</div>
                    <div class="info-value" th:text="${phieu.kyThuatVien.hoTen}"></div>
                </div>
            </div>

            <div th:if="${phieu.ghiChuKyThuat != null && !phieu.ghiChuKyThuat.isEmpty()}">
                <h3><i class="fas fa-wrench"></i> Ghi ch√∫ k·ªπ thu·∫≠t</h3>
                <div class="note-box">
                    <p th:text="${phieu.ghiChuKyThuat}"></p>
                </div>
            </div>

            <h3><i class="fas fa-dollar-sign"></i> Chi ph√≠ s·ª≠a ch·ªØa</h3>
             <div th:if="${chiTietList.isEmpty()}" class="empty-state">
                <div>üì¶</div>
                <p class="text-muted">Ch∆∞a c√≥ th√¥ng tin chi ph√≠</p>
            </div>
            <table th:if="${!chiTietList.isEmpty()}">
                 <thead>
                    <tr>
                        <th>T√™n m·ª•c</th>
                        <th style="text-align: center;">S·ªë l∆∞·ª£ng</th>
                        <th style="text-align: right;">ƒê∆°n gi√°</th>
                        <th style="text-align: right;">Th√†nh ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="ct : ${chiTietList}">
                        <td th:text="${ct.linhKien.tenLinhKien}"></td>
                        <td style="text-align: center;" th:text="${ct.soLuong}"></td>
                        <td style="text-align: right;"
                            th:text="${#numbers.formatDecimal(ct.donGia, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></td>
                        <td style="text-align: right; font-weight: bold;"
                            th:text="${#numbers.formatDecimal(ct.thanhTien, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; padding-right: 16px;">T·ªïng chi ph√≠:</td>
                        <td style="text-align: right; color: var(--primary-color); font-size: 1.2em;"
                            th:text="${#numbers.formatDecimal(phieu.tongChiPhi, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></td>
                    </tr>
                </tfoot>
            </table>

             <div class="button-group mt-4" th:if="${phieu.trangThai == 'ƒê√£ s·ª≠a xong'}">
                 <form th:action="@{/receptionist/tra-thiet-bi/{id}(id=${phieu.maPhieu})}" method="post"
                       onsubmit="return confirm('X√°c nh·∫≠n tr·∫£ thi·∫øt b·ªã n√†y cho kh√°ch h√†ng?');">
                     <button type="submit" class="btn btn-success">
                         <i class="fas fa-check-circle"></i> X√°c nh·∫≠n tr·∫£ kh√°ch & Ho√†n t·∫•t
                     </button>
                 </form>
            </div>
             <div class="alert alert-success mt-4" th:if="${phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'}">
                <i class="fas fa-check"></i> ƒê√£ tr·∫£ thi·∫øt b·ªã cho kh√°ch h√†ng.
            </div>

        </div>
    </div>
</body>
</html>