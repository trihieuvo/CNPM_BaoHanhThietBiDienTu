<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch s·ª≠ b·∫£o h√†nh</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div th:replace="~{customer/fragments :: sidebar(activePage='lich-su', khachHang=${khachHang})}"></div>

    <div class="main-content">
        <div class="card">
            <div class="header">
                <div>
                    <h1>L·ªãch s·ª≠ b·∫£o h√†nh</h1>
                    <p class="text-muted">Xem t·∫•t c·∫£ phi·∫øu s·ª≠a ch·ªØa c·ªßa b·∫°n</p>
                </div>
            </div>

            <div th:if="${danhSachPhieu.isEmpty()}" class="text-center" style="padding: 48px 0;">
                <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
                <h3 style="color: #64748b;">Ch∆∞a c√≥ l·ªãch s·ª≠ b·∫£o h√†nh</h3>
                <p class="text-muted">B·∫°n ch∆∞a c√≥ phi·∫øu s·ª≠a ch·ªØa n√†o</p>
            </div>

            <table th:if="${!danhSachPhieu.isEmpty()}">
                <thead>
                    <tr>
                        <th>M√£ phi·∫øu</th>
                        <th>Thi·∫øt b·ªã</th>
                        <th>Ng√†y ti·∫øp nh·∫≠n</th>
                        <th>Ng√†y tr·∫£ d·ª± ki·∫øn</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Chi ph√≠</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="phieu : ${danhSachPhieu}">
                        <td><strong th:text="${phieu.maPhieu}"></strong></td>
                        <td>
                            <div th:text="${phieu.thietBi.hangSanXuat + ' ' + phieu.thietBi.model}"></div>
                            <small class="text-muted" th:if="${phieu.thietBi.soSerial}" 
                                   th:text="'S/N: ' + ${phieu.thietBi.soSerial}"></small>
                        </td>
                        <td th:text="${#temporals.format(phieu.ngayTiepNhan, 'dd-MM-yyyy HH:mm')}"></td>
                        <td>
                            <span th:if="${phieu.ngayTraDuKien}" 
                                  th:text="${#temporals.format(phieu.ngayTraDuKien, 'dd-MM-yyyy')}"></span>
                            <span th:unless="${phieu.ngayTraDuKien}" class="text-muted">Ch∆∞a x√°c ƒë·ªãnh</span>
                        </td>
                        <td>
                            <span class="badge" 
                                  th:classappend="${phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'} ? 'badge-success' : 
                                                  (${phieu.trangThai == 'ƒêang s·ª≠a ch·ªØa'} ? 'badge-warning' : 
                                                  (${phieu.trangThai == 'ƒê√£ s·ª≠a xong'} ? 'badge-info' : 'badge-danger'))"
                                  th:text="${phieu.trangThai}">
                            </span>
                        </td>
                        <td>
                            <span th:if="${phieu.tongChiPhi != null}" 
                                  style="font-weight: bold; color: #667eea;"
                                  th:text="${#numbers.formatDecimal(phieu.tongChiPhi, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}">
                            </span>
                            <span th:unless="${phieu.tongChiPhi != null}" class="text-muted">Ch∆∞a t√≠nh</span>
                        </td>
                        <td>
                            <a th:href="@{/customer/phieu-sua-chua/{id}(id=${phieu.maPhieu})}" class="link">
                                Chi ti·∫øt ‚Üí
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>