<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt phi·∫øu s·ª≠a ch·ªØa</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .timeline {
            position: relative;
            padding-left: 40px;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 24px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -29px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #667eea;
        }
        .timeline-item::after {
            content: '';
            position: absolute;
            left: -24px;
            top: 20px;
            width: 2px;
            height: calc(100% - 12px);
            background: #e2e8f0;
        }
        .timeline-item:last-child::after {
            display: none;
        }
        .timeline-item strong {
            display: block;
            margin-bottom: 4px;
            color: #1e293b;
        }
        .timeline-item .text-muted {
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div>
                    <h1>Chi ti·∫øt phi·∫øu s·ª≠a ch·ªØa #<span th:text="${phieu.maPhieu}"></span></h1>
                    <p class="text-muted">Th√¥ng tin chi ti·∫øt v·ªÅ phi·∫øu s·ª≠a ch·ªØa c·ªßa b·∫°n</p>
                </div>
                <a href="/customer/lich-su-bao-hanh" class="btn btn-outline">‚Üê Quay l·∫°i</a>
            </div>

            <!-- Tr·∫°ng th√°i phi·∫øu -->
            <div style="text-align: center; margin-bottom: 32px;">
                <span class="badge" 
                      th:classappend="${phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'} ? 'badge-success' : 
                                      (${phieu.trangThai == 'ƒêang s·ª≠a ch·ªØa'} ? 'badge-warning' : 
                                      (${phieu.trangThai == 'ƒê√£ s·ª≠a xong'} ? 'badge-info' : 'badge-danger'))"
                      th:text="${phieu.trangThai}">
                </span>
            </div>

            <!-- Th√¥ng tin chung -->
            <h3>üìã Th√¥ng tin chung</h3>
            <div class="info-section">
                <div class="info-row">
                    <div class="info-label">Thi·∫øt b·ªã:</div>
                    <div class="info-value">
                        <strong th:text="${phieu.thietBi.hangSanXuat + ' ' + phieu.thietBi.model}"></strong>
                        <div th:if="${phieu.thietBi.soSerial}" class="text-muted" style="font-size: 13px;">
                            Serial: <span th:text="${phieu.thietBi.soSerial}"></span>
                        </div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">T√¨nh tr·∫°ng ti·∫øp nh·∫≠n:</div>
                    <div class="info-value" th:text="${phieu.tinhTrangTiepNhan}"></div>
                </div>
                <div class="info-row">
                    <div class="info-label">Ng√†y ti·∫øp nh·∫≠n:</div>
                    <div class="info-value" th:text="${#temporals.format(phieu.ngayTiepNhan, 'dd-MM-yyyy HH:mm')}"></div>
                </div>
                <div class="info-row" th:if="${phieu.ngayTraDuKien}">
                    <div class="info-label">Ng√†y tr·∫£ d·ª± ki·∫øn:</div>
                    <div class="info-value" th:text="${#temporals.format(phieu.ngayTraDuKien, 'dd-MM-yyyy')}"></div>
                </div>
                <div class="info-row" th:if="${phieu.ngayHoanThanh}">
                    <div class="info-label">Ng√†y ho√†n th√†nh:</div>
                    <div class="info-value" th:text="${#temporals.format(phieu.ngayHoanThanh, 'dd-MM-yyyy HH:mm')}"></div>
                </div>
                <div class="info-row" th:if="${phieu.nhanVienTiepNhan}">
                    <div class="info-label">Nh√¢n vi√™n ti·∫øp nh·∫≠n:</div>
                    <div class="info-value" th:text="${phieu.nhanVienTiepNhan.hoTen}"></div>
                </div>
                <div class="info-row" th:if="${phieu.kyThuatVien}">
                    <div class="info-label">K·ªπ thu·∫≠t vi√™n:</div>
                    <div class="info-value" th:text="${phieu.kyThuatVien.hoTen}"></div>
                </div>
            </div>

            <!-- Ghi ch√∫ k·ªπ thu·∫≠t -->
            <div th:if="${phieu.ghiChuKyThuat != null && !phieu.ghiChuKyThuat.isEmpty()}">
                <h3>üîß Ghi ch√∫ k·ªπ thu·∫≠t</h3>
                <div class="note-box">
                    <p th:text="${phieu.ghiChuKyThuat}"></p>
                </div>
            </div>

            <!-- Chi ti·∫øt linh ki·ªán -->
            <h3>üî© Linh ki·ªán thay th·∫ø</h3>
            
            <div th:if="${chiTietList.isEmpty()}" class="empty-state">
                <div>üì¶</div>
                <p class="text-muted">Ch∆∞a s·ª≠ d·ª•ng linh ki·ªán n√†o</p>
            </div>

            <table th:if="${!chiTietList.isEmpty()}">
                <thead>
                    <tr>
                        <th>T√™n linh ki·ªán</th>
                        <th style="text-align: center;">S·ªë l∆∞·ª£ng</th>
                        <th style="text-align: right;">ƒê∆°n gi√°</th>
                        <th style="text-align: right;">Th√†nh ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="ct : ${chiTietList}">
                        <td th:text="${ct.linhKien.tenLinhKien}"></td>
                        <td style="text-align: center;" th:text="${ct.soLuong}"></td>
                        <td style="text-align: right;" 
                            th:text="${#numbers.formatDecimal(ct.donGia, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></td>
                        <td style="text-align: right; font-weight: bold;" 
                            th:text="${#numbers.formatDecimal(ct.thanhTien, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; padding-right: 16px;">T·ªïng chi ph√≠:</td>
                        <td style="text-align: right; color: #667eea;" 
                            th:text="${#numbers.formatDecimal(phieu.tongChiPhi, 0, 'COMMA', 0, 'POINT') + ' VNƒê'}"></td>
                    </tr>
                </tfoot>
            </table>

            <!-- Timeline tr·∫°ng th√°i -->
            <h3>‚è±Ô∏è Ti·∫øn tr√¨nh x·ª≠ l√Ω</h3>
            <div class="timeline">
                <div class="timeline-item">
                    <strong>Ti·∫øp nh·∫≠n thi·∫øt b·ªã</strong>
                    <div class="text-muted" th:text="${#temporals.format(phieu.ngayTiepNhan, 'dd-MM-yyyy HH:mm')}"></div>
                </div>
                <div class="timeline-item" th:if="${phieu.kyThuatVien != null}">
                    <strong>ƒê√£ ph√¢n c√¥ng k·ªπ thu·∫≠t vi√™n</strong>
                    <div class="text-muted" th:text="${phieu.kyThuatVien.hoTen}"></div>
                </div>
                <div class="timeline-item" th:if="${phieu.trangThai == 'ƒêang s·ª≠a ch·ªØa' || phieu.trangThai == 'ƒê√£ s·ª≠a xong' || phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'}">
                    <strong>ƒêang s·ª≠a ch·ªØa</strong>
                    <div class="text-muted">K·ªπ thu·∫≠t vi√™n ƒëang x·ª≠ l√Ω</div>
                </div>
                <div class="timeline-item" th:if="${phieu.trangThai == 'ƒê√£ s·ª≠a xong' || phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'}">
                    <strong>ƒê√£ s·ª≠a xong</strong>
                    <div class="text-muted" 
                         th:if="${phieu.ngayHoanThanh}"
                         th:text="${#temporals.format(phieu.ngayHoanThanh, 'dd-MM-yyyy HH:mm')}"></div>
                </div>
                <div class="timeline-item" th:if="${phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'}">
                    <strong style="color: #10b981;">‚úì ƒê√£ tr·∫£ kh√°ch</strong>
                    <div class="text-muted">Ho√†n th√†nh</div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>