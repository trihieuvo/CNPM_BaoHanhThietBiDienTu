<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng ƒëi·ªÅu khi·ªÉn K·ªπ thu·∫≠t vi√™n</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .action-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .delete-btn-link {
            border: none;
            background: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0;
            text-decoration: underline;
            font-family: inherit;
            font-size: inherit;
        }
        .delete-btn-link:hover {
            color: #dc2626;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
        }
        .pagination a, .pagination span {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            text-decoration: none;
            color: #64748b;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .pagination a:hover {
            background-color: #f1f5f9;
        }
        .pagination .active {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
            font-weight: bold;
        }
        .pagination .disabled {
            color: #cbd5e1;
            pointer-events: none;
            background-color: #f8fafc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div>
                    <h1>B·∫£ng ƒëi·ªÅu khi·ªÉn K·ªπ thu·∫≠t vi√™n</h1>
                    <p class="text-muted">Danh s√°ch c√¥ng vi·ªác ƒë∆∞·ª£c giao</p>
                </div>
                <div>
                    <a href="/technician/linh-kien" class="btn btn-outline">Tra c·ª©u linh ki·ªán</a>
                    <a href="/logout" class="btn btn-secondary" style="margin-left: 8px;">ƒêƒÉng xu·∫•t</a>
                </div>
            </div>
            
            <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
            <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
            
            <div th:if="${congViecPage.empty}" class="text-center" style="padding: 48px 0;">
                <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
                <h3 style="color: #64748b;">Ch∆∞a c√≥ c√¥ng vi·ªác n√†o</h3>
                <p class="text-muted">B·∫°n ch∆∞a ƒë∆∞·ª£c giao c√¥ng vi·ªác n√†o</p>
            </div>
            
            <table th:unless="${congViecPage.empty}">
                <thead>
                    <tr>
                        <th>M√£ Phi·∫øu</th>
                        <th>T√™n Kh√°ch H√†ng</th>
                        <th>Thi·∫øt B·ªã</th>
                        <th>Ng√†y Ti·∫øp Nh·∫≠n</th>
                        <th>Tr·∫°ng Th√°i</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="phieu : ${congViecPage.content}">
                        <td><strong th:text="${phieu.maPhieu}"></strong></td>
                        <td th:text="${phieu.khachHang.hoTen}"></td>
                        <td th:text="${phieu.thietBi.model}"></td>
                        <td th:text="${#temporals.format(phieu.ngayTiepNhan, 'dd-MM-yyyy HH:mm')}"></td>
                        <td>
                            <span class="badge" 
                                  th:classappend="${phieu.trangThai == 'ƒê√£ tr·∫£ kh√°ch'} ? 'badge-success' : (${phieu.trangThai == 'ƒêang s·ª≠a ch·ªØa'} ? 'badge-warning' : (${phieu.trangThai == 'ƒê√£ s·ª≠a xong' or phieu.trangThai == 'Ho√†n th√†nh'} ? 'badge-info' : 'badge-danger'))"
                                  th:text="${phieu.trangThai}">
                            </span>
                        </td>
                        <td class="action-cell">
                            <a th:href="@{/technician/cong-viec/{id}(id=${phieu.maPhieu})}" class="link">Xem chi ti·∫øt</a>
                            <th:block th:with="completedStatuses=${#lists.toList({'ƒê√£ s·ª≠a xong', 'Ho√†n th√†nh', 'ƒê√£ tr·∫£ kh√°ch'})}">
                                <div th:if="${#lists.contains(completedStatuses, phieu.trangThai)}">
                                    <form th:action="@{/technician/cong-viec/delete/{id}(id=${phieu.maPhieu})}" method="post">
                                        <button type="submit" class="delete-btn-link"
                                                th:onclick="'return confirm(\'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a phi·∫øu #' + ${phieu.maPhieu} + '? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.\');'">
                                            X√≥a
                                        </button>
                                    </form>
                                </div>
                            </th:block>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div th:if="${congViecPage.totalPages > 1}" class="pagination">
                <a th:href="@{/technician/dashboard(page=0)}" th:classappend="${congViecPage.first} ? 'disabled' : ''">¬´ ƒê·∫ßu</a>
                <a th:href="@{/technician/dashboard(page=${congViecPage.number - 1})}" th:classappend="${congViecPage.first} ? 'disabled' : ''">‚Äπ Tr∆∞·ªõc</a>

                <th:block th:each="i : ${#numbers.sequence(0, congViecPage.totalPages - 1)}">
                    <a th:if="${i >= congViecPage.number - 2 and i <= congViecPage.number + 2}"
                       th:href="@{/technician/dashboard(page=${i})}"
                       th:classappend="${i == congViecPage.number} ? 'active' : ''"
                       th:text="${i + 1}"></a>
                </th:block>

                <a th:href="@{/technician/dashboard(page=${congViecPage.number + 1})}" th:classappend="${congViecPage.last} ? 'disabled' : ''">Sau ‚Ä∫</a>
                <a th:href="@{/technician/dashboard(page=${congViecPage.totalPages - 1})}" th:classappend="${congViecPage.last} ? 'disabled' : ''">Cu·ªëi ¬ª</a>
            </div>
        </div>
    </div>
</body>
</html>